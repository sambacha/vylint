import pytest
from web3 import Web3

N = [
    80946312435742893162269182027286168982458258986392013602913524631232064034484,
    67809251382290146368857461934422217270315634662502738506896957186896411395852,
    32432476295143674333647052353281846215904064919090353517923267849072571109732,
    97985650512097174582438390172123096127310964532713997866929284351410268860683,
    13154304360276038533660786005217728908375598918815057353003252289874621170548,
    60855634196609600593208184699147768610531128140436496744405829196935973449422,
    2514693881447445838798831742432506661944046185460035613540755019117283127655,
    79405065668804699346261014168718981824460403581712392556422464031573372741133,
]

N_HEX = 0xB2F5FD3F9F0917112CE42F8BF87ED676E15258BE443F36DEAFB0B69BDE2496B495EAAD1B01CAD84271B014E96F79386C636D348516DA74A68A8C70FBA882870C47B4218D8F49186DDF72727B9D80C21911C3E337C6E407FFB47C2F2767B0D164D8A1E9AF95F6481BF8D9EDFB2E3904B2529268C460256FAFD0A677D29898F10B1D15128A695839FC08EDD584E8335615B1D1D7277BE65C532DCA92DDC7050374868B117EA9154914EF9292B8443F13696E4FAD50DED6BD90E5A6F7ED33BE2ECE31C6DD7A4253EE6CDC56787DDD1D5CD776614022DB87D03BB22F23285B5A3167AF8DACABBEA40004471337D3781E8C5CCA0EA5E27799B510E4EF938C61CAA60D

G = 3


@pytest.fixture
def c(get_contract):
    with open("../contracts/accumulator/RSAAccumulator.vy") as f:
        code = f.read()
    # FIXME: eth.exceptions.OutOfGas: Contract code size exceeds EIP170 limit of 24577.
    c = get_contract(code, N)
    return c


def test_init_state(c):
    assert uint256_list_to_int(c.N) == N_HEX
    assert uint256_list_to_int(c.initialAccumulator) == G
    assert uint256_list_to_int(c.accumulator) == G


def uint256_list_to_int(l):
    out = 0
    for i in range(len(l)):
        out += l[i] * 2 ** (32 * i)
    return out
